# Contributing

## Website Development

A community Terraform provider must include all of the documentation to be hosted on the main Terraform website (see https://www.terraform.io/docs/providers/). These are static pages generated by Middleman from source code found at https://github.com/hashicorp/terraform-website. Rather than updating that repository directly, symlinks are created within it pointing to resources in each community provider repository. These symlinks are discussed more below.

### Setup

The following guidelines assume a UNIX environment and a Bash shell.

#### GOPATH

The `GOPATH` environment variable specifies a directory (or multiple directories) containing the source code and binaries for a user's local Go projects. The Make targets involving Terraform website integration utilize `GOPATH` too, so you'll need to set this whether or not you'll be hacking on the provider Go code itself. The standard is a directory named "go" within your home directory.

To set this variable for the current session:

```bash
GOPATH=$HOME/go
```

To have this variable set at login, add the following line to ~/.profile:

```bash
export GOPATH="$HOME/go"
```

#### Docker

Everything needed to build the website is containerized using Docker, so you'll need to have Docker installed. Instructions vary by platform.

##### Debian

See https://docs.docker.com/install/linux/docker-ce/debian/.

Be sure to add your user to the `docker` group. Otherwise you may encounter permissions issues connecting to the Docker daemon.

```bash
sudo usermod -a -G docker $USER
```

After adding the user to the docker group, you'll need to log out and spawn a new session.

#### Create terraform-website repo symlinks

**Note:** Only needed until the Citrix ITM provider is accepted as a community provider. At that time, the symlinks will be added to the official `terraform-website` repo and this section can be deleted.

The terraform-website repo contains the source code for a static website generated by Middleman.

Clone the terraform-website repo to the expected location:

```bash
$ mkdir -p $GOPATH/src/github.com/hashicorp
$ git clone https://github.com/hashicorp/terraform-website $GOPATH/src/github.com/hashicorp/terraform-website
```

Two symlinks are needed in order for Middleman to find the website code in the `terraform-provider-citrixitm` repo.

```bash
$ cd $GOPATH/src/github.com/hashicorp/terraform-website/content/source/layouts
$ ln -s ../../../ext/providers/citrixitm/website/citrixitm.erb
$ cd $GOPATH/src/github.com/hashicorp/terraform-website/content/source/docs/providers
$ ln -s ../../../../ext/providers/citrixitm/website/docs citrixitm
```

From outside of the Docker container these symlinks will appear broken, but they work inside the container because Docker mounts the directories that they point to based on the Make target used to create the container.

### Documentation Development Guidelines

When Hashicorp builds the Terraform website, sources are pulled from the `stable-website` branch of each community provider repo. You should only modify this branch when material changes have been made to the documentation and are ready to be published. Documentation source changes should accumulate in `master` and only be merged to `stable-website` when thoroughly reviewed for acceptance by team members.

Please use the following basic guidelines:

#### 1. Create pull requests to merge from `master` to `stable-website`.

This insures that team members get a chance to review documentation changes before they are published to terraform.io.

Documentation changes can accumulate in `master` and be merged to `stable-website` together under a single pull request. This allows documentation to be updated continuously without having to go through the full review process.

Collaborators may want to work out a system to facilitate creating this pull request on a somewhat regular basis so that `stable-website` doesn't fall too far behind `master`.

#### 2. Always merge from `master` to `stable-website`, never the other way around.

If any changes exist in `stable-website` that don't exist in `master`, it likely means that someone made a commit directly to `stable-website` without going through the PR process. Please don't do this.

#### 3. Making documentation source changes alongside relevant Go changes is nice.

If you're working on a new feature of the Terraform provider it's helpful, although not strictly necessary, for documentation changes to be included under the same pull request for merging your feature branch into `master`.

#### 4. Making documentation-only source changes is fine.

You may *just* want to make changes to the documentation source, not in conjunction with any specific change to the Go code. This is absolutely fine. We want the documentation to be as good as it can possibly be, so documentation-only changes are welcome. Please use the following workflow:

1. Create a feature branch based on `master`.
2. Make documentation source changes on the feature branch.
3. Submit a pull request to merge the feature branch into `master`.

### Running Middleman Locally

Working on the documentation locally involves running Middleman to generate the site, which can be viewed in a browser at http://localhost:4567. The source files for the provider documentation are found in this repository under the `website` directory. Middleman watches for changes and rebuilds the site as you edit these files. With LiveReload the browser should show the effect of changes immediately.

To get started, kick off Middleman in development mode. From the root directory of the provider project:

```bash
$ make website
```

This starts Middleman as a long running process in a new Docker container.

You should now be able to view the provider documentation, exactly as it would appear when hosted on terraform.io, by pointing your browser at http://localhost:4567/docs/providers/citrixitm.

Press `Ctrl+C` to shutdown and remove the Docker container.

You can also run the documenation acceptance tests, which basically just check for the presence of certain expected HTTP resources. From the root directory of the provider project:

```bash
$ make website-test
```

Toward the end of the output, you should see lines similar to this, indicating that things look okay:

```bash
/home/jacob/go/src/github.com/hashicorp/terraform-website/content/scripts/check-links.sh "http://127.0.0.1:4567/docs/providers/citrixitm/"
2018-09-05 16:15:12 URL:http://127.0.0.1:4567/docs/providers/citrixitm/ [23358/23358] -> "index.html.tmp.tmp" [1]
2018-09-05 16:15:12 URL:http://127.0.0.1:4567/robots.txt [44/44] -> "robots.txt.tmp" [1]
2018-09-05 16:15:12 URL:http://127.0.0.1:4567/docs/providers/citrixitm/index.html [23358/23358] -> "index.html.tmp.tmp" [1]
Found no broken links.
```
